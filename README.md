# **mp_bot_docker**  
Проект чат-бота Молодежного парламента  

## **Описание проекта**  
`mp_bot_docker` — это многофункциональный чат-бот, созданный для работы с обращениями граждан через платформу Telegram. Проект реализован в современном технологическом стеке, обеспечивая удобство взаимодействия как для пользователей, так и для администраторов.

### **Технологический стек**  
- **Фронтенд:** Vue 3, Vite, Pinia, TypeScript, TailwindCSS  
- **Бэкенд:** Django, Django REST Framework, Python 3.13, Aiogram
- **База данных:** PostgreSQL  
- **Контейнеризация:** Docker  
- **Дополнительно:** Asyncio (для асинхронных задач), Redis (кэширование)

---

### **Функционал для пользователей**  
- Отправка обращений в одну из доступных комиссий.  
- Прикрепление файлов к обращениям.  
- Просмотр статуса своих обращений в реальном времени.  
- Получение уведомлений об изменениях статуса обращений.  

---

### **Функционал для администраторов**  
Система предоставляет полный контроль над базой данных через:  
- **Панель администратора Django:** управление пользователями, заявками, комиссиями и уведомлениями.  
- **Чат-бот:** возможность обработки обращений, изменения их статусов и отправки уведомлений.  
- **Веб-интерфейс:** удобное управление всеми сущностями системы через фронтенд-приложение на Vue.  

---

### **Основные сущности в базе данных**  
1. **Пользователи:** регистрация и управление учетными записями.  
2. **Обращения:** хранение текстовых данных, статусов и прикрепленных файлов.  
3. **Комиссии:** список доступных комиссий для отправки обращений.  
4. **Уведомления:** отправка оповещений пользователям.  

---
## **Подготовка к запуску проекта**  

### **Настройка окружения**

Перед запуском проекта необходимо создать файл `.env` в корневой директории и заполнить его следующими переменными 
(подставив свои значения для секретных данных):

```ini
# -----------------------------------------------------------------------------
# Джанго-ключ; токен бота
# -----------------------------------------------------------------------------
TELEGRAM_API_TOKEN=your_telegram_bot_token
SECRET_KEY=your_django_secret_key

# -----------------------------------------------------------------------------
# База данных
# -----------------------------------------------------------------------------
DB_NAME=your_db_name
DB_USER=your_db_user
DB_PASSWORD=your_db_password
NO_DOCKER_DB_HOST=localhost
DB_HOST=host.docker.internal
DB_PORT=5432

# -----------------------------------------------------------------------------
# Запуск проекта с докер (1) или без него (0)
# -----------------------------------------------------------------------------
USE_DOCKER=1

# -----------------------------------------------------------------------------
# DJANGO_SUPERUSER (опционально)
# -----------------------------------------------------------------------------
DJANGO_SUPERUSER_NAME=admin
DJANGO_SUPERUSER_PASSWORD=admin123

# -----------------------------------------------------------------------------
# Конфигурация для Redis DB
# -----------------------------------------------------------------------------
NO_DOCKER_REDIS_HOST=localhost
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
```
---

### **Создание виртуального окружения и активация (если оно не создано и не активировано)**
- `python -m venv .venv`
- `.venv\Scripts\activate`

### **Установка зависимостей**
- `pip install -r requirements.txt`

---

## **Запуск проекта**  

1. **Запуск без Docker:**
   - Установка `USE_DOCKER=0` в `.env`.
   - Запуск Redis `~$ redis-server`.
   - Ввод в терминал: `python no_docker_start_project.py`.

2. **Запуск с Docker:**
   - Установка `USE_DOCKER=1` в `.env`.
   - Запуск Docker Desktop
   - Ввод в терминал: `docker-compose up --build`.


### **Выполнение миграций**

> URL для базы данных в `settings.py` меняется в зависимости от значения переменной `USE_DOCKER`. Поэтому выполнение миграций отличается:

- **Если запуск проекта без Docker (`USE_DOCKER=0`):**
  - Создать новые миграции (если необходимо) можно через команду:
    ```bash
    python manage.py makemigrations
    ```
  - Применение миграции:
    ```bash
    python manage.py migrate
    ```

- **Если запуск проекта с Docker (`USE_DOCKER=1`):**
  - Создать новые миграции (если необходимо) можно только внутри контейнера Django:
    ```bash
    docker exec -it django_web python manage.py makemigrations
    ```
  - Применение миграции внутри контейнера:
    ```bash
    docker exec -it django_web python manage.py migrate
    ```
  - Здесь `django_web` — это имя контейнера, указанное в `docker-compose.yml`.

---

## **Демонстрация функционала**

### **Чат-бот**  
- Для начала необходимо пройти первичную регистрацию по команде /start, чтобы данные пользователя отобразились в БД

---

## **Дальнейшие планы**

> Планируется добавление новых функций, таких как отслеживание времени внесения изменений в той или иной таблице, 
> разграничение прав для администраторов, 
> улучшение интерфейса и расширение функциональности.

---